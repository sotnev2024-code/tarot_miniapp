<!DOCTYPE html>
<html lang="ru">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>–¢–∞—Ä–æ ‚Äî –≤—ã—Ç—è–≥–∏–≤–∞–Ω–∏–µ –∫–∞—Ä—Ç</title>
<style>
body { margin:0; padding:20px; background:linear-gradient(135deg,#667eea 0%,#764ba2 100%); font-family:Arial,sans-serif; color:white; min-height:100vh; text-align:center; }
h1 { font-size:26px; margin-bottom:10px; text-shadow:2px 2px 4px rgba(0,0,0,0.4); }
.instructions { font-size:18px; margin-bottom:20px; color:#ffd700; }
.counter { background:rgba(255,255,255,0.2); padding:10px 20px; border-radius:20px; display:inline-block; margin-bottom:20px; font-size:16px; }
.card-container { perspective:1000px; display:inline-block; cursor:pointer; }
.card-inner { width:200px; height:300px; position:relative; transform-style:preserve-3d; transition:transform 0.7s ease; margin:auto; }
.card.flipped .card-inner { transform:rotateY(180deg); }
.card-front, .card-back { position:absolute; width:100%; height:100%; border-radius:12px; backface-visibility:hidden; box-shadow:0 5px 15px rgba(0,0,0,0.3); display:flex; flex-direction:column; justify-content:center; align-items:center; font-weight:bold; }
.card-back { background:rgba(255,255,255,0.9); color:#764ba2; border:3px solid transparent; }
.card-front { background:white; color:#333; transform:rotateY(180deg); border:3px solid #764ba2; }
.card-front img { max-width:100%; max-height:100%; border-radius:10px; }
.modal { display:none; position:fixed; top:0; left:0; width:100%; height:100%; background:rgba(0,0,0,0.8); z-index:1000; align-items:center; justify-content:center; }
.modal-content { background:white; border-radius:20px; padding:30px; max-width:400px; width:90%; text-align:center; color:#333; }
.modal-title { font-size:24px; color:#4CAF50; margin-bottom:15px; }
.selected-cards { background:#f5f5f5; border-radius:10px; padding:15px; margin:15px 0; max-height:300px; overflow-y:auto; }
.selected-card { display:inline-block; background:#4CAF50; color:white; padding:8px 15px; border-radius:20px; margin:5px; font-size:14px; }
.send-btn { background:#4CAF50; color:white; border:none; padding:15px 30px; border-radius:25px; font-size:18px; cursor:pointer; width:100%; margin-top:20px; }
.send-btn:hover { background:#45a049; }
</style>
</head>
<body>

<h1>–¢–∞—Ä–æ ‚Äî –≤—ã—Ç—è–≥–∏–≤–∞–Ω–∏–µ –∫–∞—Ä—Ç</h1>
<div class="instructions" id="instructions">–í—ã—Ç—è–Ω–∏—Ç–µ 3 –∫–∞—Ä—Ç—ã</div>
<div class="counter">–í—ã–±—Ä–∞–Ω–æ: <span id="selectedCount">0</span> –∏–∑ <span id="totalNeeded">3</span></div>
<div id="cardContainer" class="card-container"></div>

<div id="modal" class="modal">
  <div class="modal-content">
    <div class="modal-title">–í—ã –≤—ã–±—Ä–∞–ª–∏ –≤—Å–µ –∫–∞—Ä—Ç—ã</div>
    <p>–í–∞—à–∏ –∫–∞—Ä—Ç—ã:</p>
    <div id="modalCards" class="selected-cards"></div>
    <button id="sendBtn" class="send-btn">–û—Ç–ø—Ä–∞–≤–∏—Ç—å</button>
  </div>
</div>

<script>
// Telegram WebApp
const tg = window.Telegram?.WebApp;
if (tg) tg.expand();

// ==== –°–ø–∏—Å–æ–∫ –≤—Å–µ—Ö –∫–∞—Ä—Ç ====
const tarotCards = [
  { name:"–ë–∞—à–Ω—è", url:"https://a.plus-shop.ru/cards/Bashnja.JPG" },
  { name:"–í–µ—Ä—Ö–æ–≤–Ω—ã–π –∂—Ä–µ—Ü", url:"https://a.plus-shop.ru/cards/Verhovnyj_zhrets.JPG" },
  { name:"–í–ª—é–±–ª–µ–Ω–Ω—ã–µ", url:"https://a.plus-shop.ru/cards/Vljublennye.JPG" },
  { name:"–í–æ—Å—å–º–µ—Ä–∫–∞ –∂–µ–∑–ª–æ–≤", url:"https://a.plus-shop.ru/cards/Vos'merka_zhezlov.JPG" },
  { name:"–í–æ—Å—å–º–µ—Ä–∫–∞ –∫—É–±–∫–æ–≤", url:"https://a.plus-shop.ru/cards/Vos'merka_kubkov.JPG" },
  { name:"–í–æ—Å—å–º–µ—Ä–∫–∞ –º–µ—á–µ–π", url:"https://a.plus-shop.ru/cards/Vos'merka_mechej.JPG" },
  { name:"–í–æ—Å—å–º–µ—Ä–∫–∞ –ø–µ–Ω—Ç–∞–∫–ª–µ–π", url:"https://a.plus-shop.ru/cards/Vos'merka_pentaklej.JPG" },
  { name:"–î–≤–æ–π–∫–∞ –∂–µ–∑–ª–æ–≤", url:"https://a.plus-shop.ru/cards/Dvojka_zhezlov.JPG" },
  { name:"–î–≤–æ–π–∫–∞ –∫—É–±–∫–æ–≤", url:"https://a.plus-shop.ru/cards/Dvojka_kubkov.JPG" },
  { name:"–î–≤–æ–π–∫–∞ –º–µ—á–µ–π", url:"https://a.plus-shop.ru/cards/Dvojka_mechej.JPG" },
  { name:"–î–≤–æ–π–∫–∞ –ø–µ–Ω—Ç–∞–∫–ª–µ–π", url:"https://a.plus-shop.ru/cards/Dvojka_pentaklej.JPG" },
  { name:"–¢—Ä–æ–π–∫–∞ –∂–µ–∑–ª–æ–≤", url:"https://a.plus-shop.ru/cards/Trojka_zhezlov.JPG" },
  { name:"–¢—Ä–æ–π–∫–∞ –∫—É–±–∫–æ–≤", url:"https://a.plus-shop.ru/cards/Trojka_kubkov.JPG" },
  { name:"–¢—Ä–æ–π–∫–∞ –º–µ—á–µ–π", url:"https://a.plus-shop.ru/cards/Trojka_mechej.JPG" },
  { name:"–¢—Ä–æ–π–∫–∞ –ø–µ–Ω—Ç–∞–∫–ª–µ–π", url:"https://a.plus-shop.ru/cards/Trojka_pentaklej.JPG" },
  { name:"–ß–µ—Ç–≤–µ—Ä–∫–∞ –∂–µ–∑–ª–æ–≤", url:"https://a.plus-shop.ru/cards/Chetverka_zhezlov.JPG" },
  { name:"–ß–µ—Ç–≤–µ—Ä–∫–∞ –∫—É–±–∫–æ–≤", url:"https://a.plus-shop.ru/cards/Chetverka_kubkov.JPG" },
  { name:"–ß–µ—Ç–≤–µ—Ä–∫–∞ –º–µ—á–µ–π", url:"https://a.plus-shop.ru/cards/Chetverka_mechej.JPG" },
  { name:"–ß–µ—Ç–≤–µ—Ä–∫–∞ –ø–µ–Ω—Ç–∞–∫–ª–µ–π", url:"https://a.plus-shop.ru/cards/Chetverka_pentaklej.JPG" },
  { name:"–ü—è—Ç–µ—Ä–∫–∞ –∂–µ–∑–ª–æ–≤", url:"https://a.plus-shop.ru/cards/Pjaterka_zhezlov.JPG" },
  { name:"–ü—è—Ç–µ—Ä–∫–∞ –∫—É–±–∫–æ–≤", url:"https://a.plus-shop.ru/cards/Pjaterka_kubkov.JPG" },
  { name:"–ü—è—Ç–µ—Ä–∫–∞ –º–µ—á–µ–π", url:"https://a.plus-shop.ru/cards/Pjaterka_mechej.JPG" },
  { name:"–ü—è—Ç–µ—Ä–∫–∞ –ø–µ–Ω—Ç–∞–∫–ª–µ–π", url:"https://a.plus-shop.ru/cards/Pjaterka_pentaklej.JPG" },
  { name:"–®–µ—Å—Ç—ë—Ä–∫–∞ –∂–µ–∑–ª–æ–≤", url:"https://a.plus-shop.ru/cards/Shesterka_zhezlov.JPG" },
  { name:"–®–µ—Å—Ç—ë—Ä–∫–∞ –∫—É–±–∫–æ–≤", url:"https://a.plus-shop.ru/cards/Shesterka_kubkov.JPG" },
  { name:"–®–µ—Å—Ç—ë—Ä–∫–∞ –º–µ—á–µ–π", url:"https://a.plus-shop.ru/cards/Shesterka_mechej.JPG" },
  { name:"–®–µ—Å—Ç—ë—Ä–∫–∞ –ø–µ–Ω—Ç–∞–∫–ª–µ–π", url:"https://a.plus-shop.ru/cards/Shesterka_pentaklej.JPG" },
  { name:"–°–µ–º—ë—Ä–∫–∞ –∂–µ–∑–ª–æ–≤", url:"https://a.plus-shop.ru/cards/Semerka_zhezlov.JPG" },
  { name:"–°–µ–º—ë—Ä–∫–∞ –∫—É–±–∫–æ–≤", url:"https://a.plus-shop.ru/cards/Semerka_kubkov.JPG" },
  { name:"–°–µ–º—ë—Ä–∫–∞ –º–µ—á–µ–π", url:"https://a.plus-shop.ru/cards/Semerka_mechej.JPG" },
  { name:"–°–µ–º—ë—Ä–∫–∞ –ø–µ–Ω—Ç–∞–∫–ª–µ–π", url:"https://a.plus-shop.ru/cards/Semerka_pentaklej.JPG" },
  { name:"–î–µ–≤—è—Ç–∫–∞ –∂–µ–∑–ª–æ–≤", url:"https://a.plus-shop.ru/cards/Devjatka_zhezlov.JPG" },
  { name:"–î–µ–≤—è—Ç–∫–∞ –∫—É–±–∫–æ–≤", url:"https://a.plus-shop.ru/cards/Devjatka_kubkov.JPG" },
  { name:"–î–µ–≤—è—Ç–∫–∞ –º–µ—á–µ–π", url:"https://a.plus-shop.ru/cards/Devjatka_mechej.JPG" },
  { name:"–î–µ–≤—è—Ç–∫–∞ –ø–µ–Ω—Ç–∞–∫–ª–µ–π", url:"https://a.plus-shop.ru/cards/Devjatka_pentaklej.JPG" },
  { name:"–î–µ—Å—è—Ç–∫–∞ –∂–µ–∑–ª–æ–≤", url:"https://a.plus-shop.ru/cards/Desjatka_zhezlov.JPG" },
  { name:"–î–µ—Å—è—Ç–∫–∞ –∫—É–±–∫–æ–≤", url:"https://a.plus-shop.ru/cards/Desjatka_kubkov.JPG" },
  { name:"–î–µ—Å—è—Ç–∫–∞ –º–µ—á–µ–π", url:"https://a.plus-shop.ru/cards/Desjatka_mechej.JPG" },
  { name:"–î–µ—Å—è—Ç–∫–∞ –ø–µ–Ω—Ç–∞–∫–ª–µ–π", url:"https://a.plus-shop.ru/cards/Desjatka_pentaklej.JPG" },
  { name:"–ü–∞–∂ –∂–µ–∑–ª–æ–≤", url:"https://a.plus-shop.ru/cards/Pazh_zhezlov.JPG" },
  { name:"–ü–∞–∂ –∫—É–±–∫–æ–≤", url:"https://a.plus-shop.ru/cards/Pazh_kubkov.JPG" },
  { name:"–ü–∞–∂ –º–µ—á–µ–π", url:"https://a.plus-shop.ru/cards/Pazh_mechej.JPG" },
  { name:"–ü–∞–∂ –ø–µ–Ω—Ç–∞–∫–ª–µ–π", url:"https://a.plus-shop.ru/cards/Pazh_pentaklej.JPG" },
  { name:"–†—ã—Ü–∞—Ä—å –∂–µ–∑–ª–æ–≤", url:"https://a.plus-shop.ru/cards/Rytsar'_zhezlov.JPG" },
  { name:"–†—ã—Ü–∞—Ä—å –∫—É–±–∫–æ–≤", url:"https://a.plus-shop.ru/cards/Rytsar'_kubkov.JPG" },
  { name:"–†—ã—Ü–∞—Ä—å –º–µ—á–µ–π", url:"https://a.plus-shop.ru/cards/Rytsar'_mechej.JPG" },
  { name:"–†—ã—Ü–∞—Ä—å –ø–µ–Ω—Ç–∞–∫–ª–µ–π", url:"https://a.plus-shop.ru/cards/Rytsar'_pentaklej.JPG" },
  { name:"–ö–æ—Ä–æ–ª–µ–≤–∞ –∂–µ–∑–ª–æ–≤", url:"https://a.plus-shop.ru/cards/Koroleva_zhezlov.JPG" },
  { name:"–ö–æ—Ä–æ–ª–µ–≤–∞ –∫—É–±–∫–æ–≤", url:"https://a.plus-shop.ru/cards/Koroleva_kubkov.JPG" },
  { name:"–ö–æ—Ä–æ–ª–µ–≤–∞ –º–µ—á–µ–π", url:"https://a.plus-shop.ru/cards/Koroleva_mechej.JPG" },
  { name:"–ö–æ—Ä–æ–ª–µ–≤–∞ –ø–µ–Ω—Ç–∞–∫–ª–µ–π", url:"https://a.plus-shop.ru/cards/Koroleva_pentaklej.JPG" },
  { name:"–ö–æ—Ä–æ–ª—å –∂–µ–∑–ª–æ–≤", url:"https://a.plus-shop.ru/cards/Korol'_zhezlov.JPG" },
  { name:"–ö–æ—Ä–æ–ª—å –∫—É–±–∫–æ–≤", url:"https://a.plus-shop.ru/cards/Korol'_kubkov.JPG" },
  { name:"–ö–æ—Ä–æ–ª—å –º–µ—á–µ–π", url:"https://a.plus-shop.ru/cards/Korol'_mechej.JPG" },
  { name:"–ö–æ—Ä–æ–ª—å –ø–µ–Ω—Ç–∞–∫–ª–µ–π", url:"https://a.plus-shop.ru/cards/Korol'_pentaklej.JPG" },
  { name:"–ò–º–ø–µ—Ä–∞—Ç—Ä–∏—Ü–∞", url:"https://a.plus-shop.ru/cards/Imperatritsa.JPG" },
  { name:"–ò–º–ø–µ—Ä–∞—Ç–æ—Ä", url:"https://a.plus-shop.ru/cards/Imperator.JPG" },
  { name:"–ú–∞–≥", url:"https://a.plus-shop.ru/cards/Mag.JPG" },
  { name:"–ñ—Ä–∏—Ü–∞", url:"https://a.plus-shop.ru/cards/Zhritsa.JPG" },
  { name:"–ó–≤–µ–∑–¥–∞", url:"https://a.plus-shop.ru/cards/Zvezda.JPG" },
  { name:"–õ—É–Ω–∞", url:"https://a.plus-shop.ru/cards/Luna.JPG" },
  { name:"–°–æ–ª–Ω—Ü–µ", url:"https://a.plus-shop.ru/cards/Solntse.JPG" },
  { name:"–°—É–¥", url:"https://a.plus-shop.ru/cards/Sud.JPG" },
  { name:"–ú–∏—Ä", url:"https://a.plus-shop.ru/cards/Mir.JPG" },
  { name:"–£–º–µ—Ä–µ–Ω–Ω–æ—Å—Ç—å", url:"https://a.plus-shop.ru/cards/Umerennost'.JPG" },
  { name:"–ü–æ–≤–µ—à–µ–Ω–Ω—ã–π", url:"https://a.plus-shop.ru/cards/Poveshennyj.JPG" },
  { name:"–°–º–µ—Ä—Ç—å", url:"https://a.plus-shop.ru/cards/Smert'.JPG" },
  { name:"–î—å—è–≤–æ–ª", url:"https://a.plus-shop.ru/cards/D'javol.JPG" },
  { name:"–®—É—Ç", url:"https://a.plus-shop.ru/cards/shut.JPG" }
];

let selectedCards = [];
let cardsNeeded = 3;
let currentDeck = [];

document.addEventListener("DOMContentLoaded", () => {
  // –ü–æ–ª—É—á–∞–µ–º –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –∫–∞—Ä—Ç –∏–∑ URL
  const urlParams = new URLSearchParams(window.location.search);
  const cardsParam = urlParams.get("cards");
  if (cardsParam) {
    cardsNeeded = parseInt(cardsParam);
    document.getElementById("totalNeeded").textContent = cardsNeeded;
    document.getElementById("instructions").textContent = `–í—ã—Ç—è–Ω–∏—Ç–µ ${cardsNeeded} –∫–∞—Ä—Ç`;
  }

  currentDeck = [...tarotCards];
  shuffle(currentDeck);
  showNextCard();

  document.getElementById("sendBtn").addEventListener("click", sendData);
});

function shuffle(array) {
  for (let i = array.length - 1; i > 0; i--) {
    const j = Math.floor(Math.random()*(i+1));
    [array[i], array[j]] = [array[j], array[i]];
  }
}

function showNextCard() {
  const container = document.getElementById("cardContainer");
  container.innerHTML = "";
  if (selectedCards.length >= cardsNeeded || currentDeck.length === 0) {
    showModal();
    return;
  }
  const cardObj = currentDeck.pop();
  container.innerHTML = `
    <div class="card">
      <div class="card-inner">
        <div class="card-back">üîÆ</div>
        <div class="card-front">
          <img src="${cardObj.url}" alt="${cardObj.name}">
          <div class="card-text">${cardObj.name}</div>
        </div>
      </div>
    </div>
  `;
  const cardEl = container.querySelector(".card");
  cardEl.addEventListener("click", () => selectThis(cardObj, cardEl));
}

function selectThis(cardObj, cardEl) {
  cardEl.classList.add("flipped");
  selectedCards.push(cardObj);
  document.getElementById("selectedCount").textContent = selectedCards.length;

  setTimeout(() => {
    cardEl.style.transition = "transform 0.5s ease, opacity 0.5s ease";
    cardEl.style.transform = "translateX(500px) rotate(30deg)";
    cardEl.style.opacity = "0";
    setTimeout(showNextCard, 500);
  }, 800);
}

function showModal() {
  const modal = document.getElementById("modal");
  const modalCards = document.getElementById("modalCards");
  modalCards.innerHTML = "";
  selectedCards.forEach(c => {
    const el = document.createElement("div");
    el.className = "selected-card";
    el.textContent = c.name;
    modalCards.appendChild(el);
  });
  modal.style.display = "flex";
}

function sendData() {
  const result = selectedCards.map(c => c.name);
  if (tg && tg.sendData) {
    console.log("TG object:", tg);
    tg.sendData(JSON.stringify({cards: result, count: result.length}));
    tg.close();
  } else {
    alert("–í—ã –≤—ã–±—Ä–∞–ª–∏ –∫–∞—Ä—Ç—ã:\n" + result.join(", "));
  }
}
</script>
</body>
</html>
